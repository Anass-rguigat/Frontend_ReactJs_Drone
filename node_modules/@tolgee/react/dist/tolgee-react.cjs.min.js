"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@tolgee/web");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e);function s(n,r,s,o=!0){const[a]=e.useState((()=>{return e=n,Object.assign(Object.assign({},e),{t(...n){const r=t.getTranslateProps(...n);return e.t(Object.assign(Object.assign({},r),{noWrap:!0}))}});var e})),[l,c]=e.useState(o);return e.useEffect((()=>{c(!1)}),[]),e.useMemo((()=>{o&&(n.setEmitterActive(!1),n.addStaticData(s),n.changeLanguage(r),n.setEmitterActive(!0))}),[r,s,n]),e.useState((()=>{if(!n.isLoaded()&&o){const e=n.getRequiredDescriptors(r),t=n.getAllRecords(),s=e.map((({namespace:e,language:t})=>e?`${e}:${t}`:t)).filter((e=>!t.find((t=>(null==t?void 0:t.cacheKey)===e))));console.warn(`Tolgee: Missing records in "staticData" for proper SSR functionality: ${s.map((e=>`"${e}"`)).join(", ")}`)}})),l?a:n}const o={useSuspense:!1};let a;const l=()=>(a||(a=r.default.createContext(void 0)),a);let c;let u;const i=()=>{const t=l(),n=e.useContext(t)||u;if(!n)throw new Error("Couldn't find tolgee instance, did you forgot to use `TolgeeProvider`?");return n},d=()=>{const[t,n]=e.useState(0);return{instance:t,rerender:e.useCallback((()=>{n((e=>e+1))}),[n])}},f=(n,r)=>{const{tolgee:s,options:o}=i(),a=t.getFallback(n),l=t.getFallbackArray(a).join(":"),c=Object.assign(Object.assign({},o),r),{rerender:u,instance:f}=d();e.useRef([]).current=[];const g=s.isLoaded(a);e.useEffect((()=>{const e=s.on("update",u);return()=>{e.unsubscribe()}}),[l,s]),e.useEffect((()=>(s.addActiveNs(a),()=>s.removeActiveNs(a))),[l,s]);const p=e.useCallback((e=>{var t;const n=null!==(t=e.ns)&&void 0!==t?t:null==a?void 0:a[0];return s.t(Object.assign(Object.assign({},e),{ns:n}))}),[s,f]);if(c.useSuspense&&!g)throw s.addActiveNs(a,!0);return{t:p,isLoading:!g}};const g=e=>{if(!e)return;const t={};return Object.entries(e||{}).forEach((([e,n])=>{if("function"==typeof n)t[e]=e=>n(p(e));else if(r.default.isValidElement(n)){const s=n;t[e]=e=>void 0===s.props.children&&(null==e?void 0:e.length)?r.default.cloneElement(s,{},p(e)):r.default.cloneElement(s)}else t[e]=n})),t},p=e=>{const t=(n=e,Array.isArray(n)&&1===n.length?n[0]:n);var n;return Array.isArray(t)?t.map(((e,t)=>r.default.createElement(r.default.Fragment,{key:t},e))):t},b=e=>{const t=e.keyName||e.children;void 0===t&&console.error("T component: keyName not defined");const n=e.defaultValue||(e.keyName?e.children:void 0),s=p(e.t({key:t,params:g(e.params),defaultValue:n,noWrap:e.noWrap,ns:e.ns,language:e.language}));return r.default.createElement(r.default.Fragment,null,s)};exports.GlobalContextPlugin=e=>t=>(u={tolgee:t,options:Object.assign(Object.assign({},o),e)},t),exports.T=e=>{const{t:t}=f();return r.default.createElement(b,Object.assign({t:t},e))},exports.TBase=b,exports.TolgeeProvider=({tolgee:t,options:n,children:a,fallback:u,ssr:i})=>{e.useEffect((()=>{(null==c?void 0:c.run)!==t.run&&(c&&c.stop(),c=t,t.run().catch((e=>{console.error(e)})).finally((()=>{b(!1)})))}),[t]);let d=t;const{language:f,staticData:g}="object"!=typeof i?{}:i;d=s(t,f,g,Boolean(i));const[p,b]=e.useState(!d.isLoaded()),v=Object.assign(Object.assign({},o),n),m=l();return v.useSuspense?r.default.createElement(m.Provider,{value:{tolgee:d,options:v}},p?u:r.default.createElement(e.Suspense,{fallback:u||null},a)):r.default.createElement(m.Provider,{value:{tolgee:d,options:v}},p?u:a)},exports.getProviderInstance=l,exports.useTolgee=t=>{const{tolgee:n}=i(),{rerender:r}=d();return e.useEffect((()=>{const e=null==t?void 0:t.map((e=>n.on(e,r)));return()=>{null==e||e.forEach((e=>e.unsubscribe()))}}),[null==t?void 0:t.join(":")]),n},exports.useTolgeeSSR=s,exports.useTranslate=(n,r)=>{const{t:s,isLoading:o}=f(n,r);return{t:e.useCallback(((...e)=>{const n=t.getTranslateProps(...e);return s(n)}),[s]),isLoading:o}},Object.keys(t).forEach((function(e){"default"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}));
//# sourceMappingURL=tolgee-react.cjs.min.js.map
